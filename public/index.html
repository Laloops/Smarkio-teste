<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="/index.css" rel="stylesheet">
    <title>Página de comentários</title>
</head>

<body>
    <div class="container-fluid">
        <div class="row conteudo">
            <div class="box-comentarios col-md-6">
                <div class="titulo">
                    Comentário
                </div>
                <textarea id="coment" name="coment" rows="5" cols="50" maxlength="255"
                    placeholder="Digite seu comentário aqui..."></textarea>
                <button id="format-button" type="submit">Enviar</button>
            </div>
            <div class="lista-comentarios col-md-6">
                <div class="titulo">
                    Comentários
                </div>
                <div class="scroll-lista">
                    <div class="linha-comentario">
                        <div class="fonte-coment" id="comentario-digitado">
                            <div class="card-coment">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                                eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                                quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>
<script>
    var xhttp = new XMLHttpRequest();

    const respostaCadastraMensagem = function () {
        if (xhttp.readyState == 4 && (xhttp.status == 201 || xhttp.status == 200)) {
            document.getElementById('coment').value = "";
            capturando = "";
            carregarComentarios();
        } else if (xhttp.readyState == 4 && (xhttp.status != 201 || xhttp.status != 200)) {
            alert("errou");
        }
    }
    const respostaBuscaMensagem = function () {
        if (xhttp.readyState == 4 && (xhttp.status == 201 || xhttp.status == 200)) {
            let data = JSON.parse(xhttp.response);
            // document.getElementById('comentario-digitado').innerHTML = ""
            //  data.forEach(element => {
            //     document.getElementById('comentario-digitado').innerHTML += "<div>" + element.texto +
            //        "</div> <br>";
            //  });
        } else if (xhttp.readyState == 4 && (xhttp.status != 201 || xhttp.status != 200)) {
            alert("Ocorreu um erro");
        }
    }
    const carregarComentarios = function () {
        xhttp.open("GET", "http://localhost:3000/comentario", true);
        xhttp.onload = respostaBuscaMensagem
        xhttp.onerror = respostaBuscaMensagem
        xhttp.send();
    }
    const cadastrarComentarios = function () {
        var data = {
            'mensagem': capturando
        }
        xhttp.open("POST", "http://localhost:3000/comentario", true);
        xhttp.onload = respostaCadastraMensagem
        xhttp.onerror = respostaCadastraMensagem
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send(JSON.stringify(data));
    }

    document.addEventListener("DOMContentLoaded", function (event) {
        carregarComentarios();
    });

    var capturando = "";

    function capturar() {
        capturando = document.getElementById('coment').value;
    }


    function sndMsg() {
        capturar();
        if (capturando.length <= 255) {
            cadastrarComentarios();
        } else {
            alert("Você ultrapassou o limite máximo de caracteres...")
        }
    }
    document.getElementById("format-button").addEventListener("click", sndMsg)
</script>

</html>